---
import { navLinks } from '../data/navigation';

interface Props {
  activeSection: string;
}

const { activeSection } = Astro.props;
---

<!-- Navegación Desktop -->
<nav class="sticky top-0 z-50 bg-darker">
  <div class="hidden md:flex justify-center py-3">
    {navLinks.map((link) => (
      <a
        href={link.href}
        class={`text-white no-underline px-2.5 inline-block h-6 nav-link ${activeSection === link.section ? 'pagina-activada' : ''}`}
      >
        {link.label}
      </a>
    ))}
  </div>

  <!-- Header móvil con botón hamburguesa -->
  <div class="flex md:hidden items-center justify-between px-4 py-3">
    <span class="text-white font-semibold text-sm">Dave Chappelle</span>
    <button
      id="menu-toggle"
      class="flex flex-col justify-center gap-1.5 w-10 h-10 bg-transparent border-none cursor-pointer p-2 z-[60] hamburger"
      aria-label="Abrir menú de navegación"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="block w-full h-[3px] bg-white rounded-sm transition-all duration-300 ease-in-out origin-center hamburger-line"></span>
      <span class="block w-full h-[3px] bg-white rounded-sm transition-all duration-300 ease-in-out origin-center hamburger-line"></span>
      <span class="block w-full h-[3px] bg-white rounded-sm transition-all duration-300 ease-in-out origin-center hamburger-line"></span>
    </button>
  </div>
</nav>

<!-- Overlay -->
<div id="menu-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 opacity-0 invisible transition-all duration-300 ease-in-out menu-overlay"></div>

<!-- Drawer móvil -->
<aside
  id="mobile-menu"
  class="fixed top-0 left-0 w-[280px] max-w-[85vw] h-screen bg-gradient-to-b from-[#1a1b20] to-[#0e0f13] z-50 -translate-x-full transition-transform duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] shadow-[4px_0_20px_rgba(0,0,0,0.5)] overflow-y-auto mobile-drawer"
  aria-hidden="true"
>
  <div class="flex justify-between items-center p-4 px-5 border-b border-white/10">
    <span class="text-white font-bold text-lg">Navegación</span>
    <button
      id="menu-close"
      class="flex items-center justify-center w-9 h-9 bg-white/10 border-none rounded-lg text-white cursor-pointer transition-colors duration-200 ease-in-out hover:bg-red-accent/30"
      aria-label="Cerrar menú"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <nav class="flex flex-col py-4">
    {navLinks.map((link) => (
      <a
        href={link.href}
        class={`flex items-center gap-3 py-3.5 px-5 text-white/80 no-underline text-[0.95rem] transition-all duration-200 ease-in-out border-l-[3px] border-transparent hover:bg-white/5 hover:text-white hover:border-l-red-accent/50 drawer-link ${activeSection === link.section ? 'text-white bg-red-accent/10 !border-l-red-accent drawer-link-active' : ''}`}
      >
        <span class={`w-1.5 h-1.5 rounded-full bg-white/20 transition-all duration-200 ease-in-out drawer-link-indicator ${activeSection === link.section ? '!bg-red-accent shadow-[0_0_8px_rgba(255,2,19,0.5)] animate-pulse' : ''}`}></span>
        {link.label}
      </a>
    ))}
  </nav>
</aside>

<style>
  /* === Estilos Desktop (pseudo-elementos) === */
  .nav-link::after {
    content: "";
    display: block;
    margin: 0 auto;
    width: 0;
  }

  .nav-link:hover::after {
    border-bottom: 2px solid #ff0213;
    width: 100%;
    transition: width 0.5s;
  }

  .pagina-activada::after {
    content: "";
    display: block;
    width: 100%;
    animation: 6s infinite ease-in-out mianimacion;
  }

  /* === Animación hamburguesa a X === */
  .hamburger.is-active .hamburger-line:nth-child(1) {
    transform: translateY(9px) rotate(45deg);
  }

  .hamburger.is-active .hamburger-line:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
  }

  .hamburger.is-active .hamburger-line:nth-child(3) {
    transform: translateY(-9px) rotate(-45deg);
  }

  /* === Estados activos (controlados por JS) === */
  .menu-overlay.is-visible {
    opacity: 1;
    visibility: visible;
  }

  .mobile-drawer.is-open {
    transform: translateX(0);
  }

  /* === Hover en indicador del drawer === */
  .drawer-link:hover .drawer-link-indicator {
    background: #ff0213;
    box-shadow: 0 0 8px rgba(255, 2, 19, 0.5);
  }
</style>

<script>
  const menuToggle = document.getElementById('menu-toggle');
  const menuClose = document.getElementById('menu-close');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuOverlay = document.getElementById('menu-overlay');

  function openMenu() {
    menuToggle?.classList.add('is-active');
    mobileMenu?.classList.add('is-open');
    mobileMenu?.classList.remove('-translate-x-full');
    mobileMenu?.classList.add('translate-x-0');
    menuOverlay?.classList.add('is-visible');
    mobileMenu?.setAttribute('aria-hidden', 'false');
    menuToggle?.setAttribute('aria-expanded', 'true');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    menuToggle?.classList.remove('is-active');
    mobileMenu?.classList.remove('is-open');
    mobileMenu?.classList.remove('translate-x-0');
    mobileMenu?.classList.add('-translate-x-full');
    menuOverlay?.classList.remove('is-visible');
    mobileMenu?.setAttribute('aria-hidden', 'true');
    menuToggle?.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
  }

  menuToggle?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.contains('is-open');
    if (isOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  menuClose?.addEventListener('click', closeMenu);
  menuOverlay?.addEventListener('click', closeMenu);

  // Cerrar con tecla Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileMenu?.classList.contains('is-open')) {
      closeMenu();
    }
  });
</script>
